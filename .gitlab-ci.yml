stages:
  - build

# -----------------------------------------------------------------------------
# JOB ANDROID (G√©n√®re l'APK)
# -----------------------------------------------------------------------------
build_android:
  stage: build
  image: reactnativecommunity/react-native-android:latest
  tags:
    - saas-linux-medium-amd64
  before_script:
    - npm install --legacy-peer-deps
  script:
    - echo "ü§ñ Compilation Android en cours..."
    - cd android
    - chmod +x gradlew
    - ./gradlew assembleDebug
  artifacts:
    paths:
      - android/app/build/outputs/apk/debug/app-debug.apk
    expire_in: 1 week

# -----------------------------------------------------------------------------
# JOB iOS (Compile le code sur Mac M1 - V√©rification)
# -----------------------------------------------------------------------------
build_ios:
  stage: build
  tags:
    - saas-macos-medium-m1
  image: macos-13-xcode-14
  before_script:
    - npm install --legacy-peer-deps
    - cd ios
    - pod install
  script:
    - echo "üçè Compilation iOS en cours (Mode Simulateur pour valider le code)..."
    - xcodebuild -workspace MalinWallet.xcworkspace -scheme MalinWallet -configuration Debug -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 14' build CODE_SIGNING_ALLOWED=NO
  artifacts:
    paths:
      - ios/build/
    expire_in: 1 week
